(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5301:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(7691)}])},7691:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return J}});var r=t(5893),a=t(1954),o=t(7357),i=t.n(o);function s(){return(0,r.jsx)("div",{style:{flex:1}})}var c=t(3630),l=t.n(c);function u(e){var n=e.icon,t=e.disabled,o=e.onClick;return(0,r.jsx)("button",{className:l().button,type:"button",disabled:t,onClick:o,children:(0,r.jsx)(a.JO,{icon:n})})}var d,p,f,h=t(7294),_=t(2077),v=t.n(_),m=t(8237),g=t.n(m);function b(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}(p=d||(d={})).READY="ready",p.PROCESSING="processing",p.NO_RECORDS="no-records",p.FAILED="failed";var x=(b(f={},d.READY,"app:file"),b(f,d.PROCESSING,"app:file"),b(f,d.NO_RECORDS,"app:file-unknown"),b(f,d.FAILED,"app:file-alert"),f);function y(e){var n=e.item,t=(0,h.useState)(d.PROCESSING),o=t[0],i=t[1],c=(0,h.useState)(0),l=c[0],p=c[1],f=(0,h.useState)(""),_=f[0],m=f[1],y=(0,h.useCallback)((function(){i(function(e){return void 0!==e.failureReason?d.FAILED:e.processedPages===e.pagesCount?e.records.length?d.READY:d.NO_RECORDS:d.PROCESSING}(n)),p(n.pagesCount?n.processedPages/n.pagesCount:0);var e=v()(n.records.length).format("0,0"),t="".concat(e," Record").concat("1"!==e?"s":"");n.failureReason?m(n.failureReason):n.processedPages===n.pagesCount?m(t):void 0===n.pagesCount?m("Loading document"):m("Processing page ".concat(n.processedPages+1,"/").concat(n.pagesCount))}),[n]);(0,h.useEffect)((function(){return y(),n.onUpdate=y,function(){delete n.onUpdate}}),[y,n]);var w=(0,h.useCallback)((function(){n.exportAndSaveRecords()}),[n]),C=Math.floor(1e4*l)/100;return(0,r.jsxs)("div",{className:g().outer_container,"data-state":o,children:[o===d.PROCESSING&&(0,r.jsx)("div",{className:g().progress_bar,style:b({},"--progress","".concat(C,"%"))}),(0,r.jsxs)("div",{className:g().inner_container,children:[(0,r.jsx)("div",{className:g().icon_container,children:(0,r.jsx)(a.JO,{icon:x[o]})}),(0,r.jsx)("div",{className:g().document_label,children:n.file.name}),(0,r.jsx)(s,{}),(0,r.jsx)("div",{className:g().sub_label,children:o===d.NO_RECORDS?"No records":_}),o===d.READY&&(0,r.jsx)(u,{icon:"app:download",onClick:w})]})]})}var w=t(8520),C=t.n(w),k=t(9299),j=t(2600),S=t(3162),E=t(5733),N=t.n(E),R=t(381),A=t.n(R),O=t(3835);function P(e,n,t,r,a,o,i){try{var s=e[o](i),c=s.value}catch(l){return void t(l)}s.done?n(c):Promise.resolve(c).then(r,a)}function D(e){return function(){var n=this,t=arguments;return new Promise((function(r,a){var o=e.apply(n,t);function i(e){P(o,r,a,i,s,"next",e)}function s(e){P(o,r,a,i,s,"throw",e)}i(void 0)}))}}function T(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(t.push(i.value),!n||t.length!==n);r=!0);}catch(c){a=!0,o=c}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Y(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var M=0,U=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.file=n,this.id=M++,this.records=[],this._processedPages=0,this.processingStarted=!1}var n,t,r;return n=e,r=[{key:"exportAndSaveMultipleDocuments",value:function(e){return D(C().mark((function n(){var t,r,a;return C().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=new(N()),e.forEach((function(e){var n=I(e.exportRecords(),2),r=n[0],a=n[1];t.file(r,a)})),n.next=4,t.generateAsync({type:"blob"});case 4:r=n.sent,a=A()().format("[marks_]YYYY-MM-DD_HH-mm[.zip]"),(0,S.saveAs)(r,a);case 7:case"end":return n.stop()}}),n)})))()}},{key:"createAndSaveCSVTable",value:function(e){var n=new Set,t=[],r=[],a=new Set,o={},i=!0,s=!1,c=void 0;try{for(var l,u=function(e,i){var s=i.value,c=s.file.name.replace(/.pdf$/,"");a.add(c),o[c]={},s.records.forEach((function(e){var a,i,s=e.studentId,l=e.studentName,u=e.studentFatherName,d=e.examMark;n.add(s),null!==l&&l.length>(null!==(a=t[s])&&void 0!==a?a:"").length&&(t[s]=l),null!==u&&u.length>(null!==(i=r[s])&&void 0!==i?i:"").length&&(r[s]=u),null!==d&&(o[c][s]=d)}))},d=e[Symbol.iterator]();!(i=(l=d.next()).done);i=!0)u(0,l)}catch(v){s=!0,c=v}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}var p=[];n.forEach((function(e){var n,i,s,c=[e,null!==(n=t[e])&&void 0!==n?n:null,null!==(i=r[e])&&void 0!==i?i:null];a.forEach((function(n){return c.push(null!==(s=o[n][e])&&void 0!==s?s:0)})),p.push(c)}));var f=(0,O.P)(p,{header:!0,columns:["id","name","father"].concat(Y(Array.from(a.values()))),quoted_string:!0}),h=new Blob([f],{type:"text/csv;charset=utf-8"}),_=A()().format("[marks_]YYYY-MM-DD_HH-mm[.csv]");(0,S.saveAs)(h,_)}}],(t=[{key:"pagesCount",get:function(){return this._pagesCount}},{key:"processedPages",get:function(){return this._processedPages}},{key:"failureReason",get:function(){return this._failureReason}},{key:"exportRecords",value:function(){var e=JSON.stringify(this.records,void 0,"\t"),n=new Blob([e],{type:"application/json;charset=utf-8"});return[this.file.name.replace(/.pdf$/,".json"),n]}},{key:"exportAndSaveRecords",value:function(){var e=I(this.exportRecords(),2),n=e[0],t=e[1];(0,S.saveAs)(t,n)}},{key:"startProcessing",value:function(){return D(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.processingStarted){e.next=2;break}throw new Error("The processing was already started/attempted.");case 2:if("application/pdf"===this.file.type){e.next=6;break}return this._failureReason="Unsupported document format",this.triggerUpdate(),e.abrupt("return");case 6:return e.prev=6,e.next=9,this.process();case 9:e.next=16;break;case 11:e.prev=11,e.t0=e.catch(6),console.error("Error while processing document:",e.t0),this._failureReason=void 0===this._pagesCount?"Failed to load document":"Failed to process page ".concat(this._processedPages+1,"/").concat(this._pagesCount),this.triggerUpdate();case 16:this.document&&(this.document.destroy(),delete this.document);case 17:case"end":return e.stop()}}),e,this,[[6,11]])})).bind(this))()}},{key:"process",value:function(){return D(C().mark((function e(){var n,t,r,a,o,i;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.file.arrayBuffer();case 2:return n=e.sent,t=new Uint8Array(n),e.next=6,(0,k.getDocument)(t).promise;case 6:this.document=e.sent,this._pagesCount=this.document.numPages,this.triggerUpdate(),r=1;case 10:if(!(r<=this.document.numPages)){e.next=24;break}return e.next=14,this.document.getPage(r);case 14:return o=e.sent,e.next=17,(0,j.$g)(o);case 17:i=e.sent,(a=this.records).push.apply(a,Y(i)),this._processedPages++,this.triggerUpdate();case 21:r++,e.next=10;break;case 24:case"end":return e.stop()}}),e,this)})).bind(this))()}},{key:"triggerUpdate",value:function(){if(this.onUpdate)try{this.onUpdate(this)}catch(e){console.error("Error while triggering 'onUpdate':",e)}}}])&&T(n.prototype,t),r&&T(n,r),e}();function F(e){var n=e.allowClearAll,t=e.onClearAll;return(0,r.jsxs)("div",{className:i().top_bar,children:[(0,r.jsxs)("span",{className:i().title,children:["MarksBench - v","1.1.0"]}),(0,r.jsx)(s,{}),(0,r.jsx)(u,{icon:"app:clear-all",onClick:t,disabled:!n}),(0,r.jsx)(u,{icon:"app:github",onClick:function(){return window.open("https://github.com/Rami-Sabbagh/MarksBench/","_blank","noopener,noreferrer")}})]})}function V(e){var n=e.allowCreateCSVTable,t=e.onCreateCSVTable,o=e.allowSaveZip,c=e.onSaveZip,l=e.onFilesSelection,d=(0,h.useRef)(null),p=(0,h.useCallback)((function(){var e;null===(e=d.current)||void 0===e||e.click()}),[]),f=(0,h.useCallback)((function(e){e.target.files&&l&&l(e.target.files)}),[l]);return(0,r.jsxs)("div",{className:i().bottom_bar,children:[(0,r.jsxs)("span",{className:i().footer,children:["Made with ",(0,r.jsx)(a.JO,{className:i().heart,icon:"app:heart",inline:!0})," ","by ",(0,r.jsx)("a",{href:"https://github.com/Rami-Sabbagh/",rel:"noreferrer",target:"_blank",children:"Rami Sabbagh"})]}),(0,r.jsx)(s,{}),(0,r.jsx)(u,{icon:"app:table",onClick:t,disabled:!n}),(0,r.jsx)(u,{icon:"app:zip",onClick:c,disabled:!o}),(0,r.jsx)(u,{icon:"app:add-file",onClick:p}),(0,r.jsx)("input",{type:"file",ref:d,onChange:f,style:{display:"none"},accept:"application/pdf",multiple:!0})]})}function H(){return(0,r.jsxs)("div",{className:i().placeholder,children:[(0,r.jsx)(a.JO,{className:i().icon,icon:"app:document"}),(0,r.jsx)("div",{className:i().title,children:"Drop exams marks documents here"}),(0,r.jsxs)("div",{className:i().sub_title,children:["Which you can download from the"," ",(0,r.jsxs)("a",{href:"http://damascusuniversity.edu.sy/ite/index.php?func=7&set=14",rel:"noreferrer noopener",target:"_blank",children:["faculty","'","s website"]})]}),(0,r.jsxs)("div",{className:i().select_files_hint,children:[(0,r.jsx)("span",{children:"or you can select the files"}),(0,r.jsx)(a.JO,{className:i().arrow,icon:"app:arrow-down"})]})]})}function L(e){var n=e.entries;return(0,r.jsx)("div",{className:i().documents_list,children:(0,r.jsx)("div",{className:i().item_container,children:n.map((function(e){return(0,r.jsx)(y,{item:e},e.id)}))})})}function J(){var e=(0,h.useState)([]),n=e[0],t=e[1],a=(0,h.useCallback)((function(e){var r,a;e.preventDefault();var o=[];if(null===(r=e.dataTransfer)||void 0===r?void 0:r.items)for(var i=e.dataTransfer.items,s=0;s<i.length;s++){if("file"===i[s].kind){var c=i[s].getAsFile();null!==c&&o.push(c)}}else if(null===(a=e.dataTransfer)||void 0===a?void 0:a.files)for(var l=e.dataTransfer.files,u=0;u<l.length;u++)o.push(l[u]);var d=o.map((function(e){return new U(e)}));d.forEach((function(e){return e.startProcessing().catch(console.error)})),t(n.concat(d))}),[n]),o=(0,h.useCallback)((function(e){e.preventDefault()}),[]),s=(0,h.useCallback)((function(e){for(var r=[],a=0;a<e.length;a++)r.push(e[a]);var o=r.map((function(e){return new U(e)}));o.forEach((function(e){return e.startProcessing().catch(console.error)})),t(n.concat(o))}),[n]);(0,h.useEffect)((function(){return document.addEventListener("drop",a),document.addEventListener("dragover",o),function(){document.removeEventListener("dragover",o),document.removeEventListener("drop",a)}}),[a,o]);var c=(0,h.useCallback)((function(){U.createAndSaveCSVTable(n)}),[n]),l=(0,h.useState)(!1),u=l[0],d=l[1],p=(0,h.useCallback)((function(){d(!0),U.exportAndSaveMultipleDocuments(n).then((function(){return d(!1)})).catch(console.error)}),[n]);return(0,r.jsx)("div",{className:i().drop_zone,children:(0,r.jsxs)("div",{className:i().application,children:[(0,r.jsx)(F,{allowClearAll:0!==n.length,onClearAll:function(){return t([])}}),0===n.length&&(0,r.jsx)(H,{}),0!==n.length&&(0,r.jsx)(L,{entries:n}),(0,r.jsx)(V,{onFilesSelection:s,allowCreateCSVTable:0!==n.length,onCreateCSVTable:c,allowSaveZip:0!==n.length&&!u,onSaveZip:p})]})})}},8237:function(e){e.exports={outer_container:"document-item_outer_container__GFw1Y",progress_bar:"document-item_progress_bar__jwO8W",inner_container:"document-item_inner_container__q_H_R",icon_container:"document-item_icon_container__tO6_v",document_label:"document-item_document_label__6Jziq",sub_label:"document-item_sub_label__oWNXC"}},3630:function(e){e.exports={button:"icon-button_button__80gIQ"}},7357:function(e){e.exports={application:"application_application__uxrt1",top_bar:"application_top_bar__9agdm",title:"application_title__IHysO",bottom_bar:"application_bottom_bar__puspk",footer:"application_footer__q3d1R",heart:"application_heart__ItVZS",placeholder:"application_placeholder__MiZgE",icon:"application_icon__djHsE",sub_title:"application_sub_title__i278q",select_files_hint:"application_select_files_hint__B7nZ5",arrow:"application_arrow__R1pny",documents_list:"application_documents_list__OH2Vr",items_container:"application_items_container__cV__A"}},2361:function(){},4616:function(){}},function(e){e.O(0,[885,317,774,888,179],(function(){return n=5301,e(e.s=n);var n}));var n=e.O();_N_E=n}]);